// =============================================================================
// budget.dart - 예산 데이터 모델
// =============================================================================
// 이 파일은 '예산' 데이터의 구조를 정의합니다.
// 예: 식비 300,000원, 교통비 100,000원 같은 월별 예산 항목
// =============================================================================

// Hive 데이터베이스 패키지를 불러옵니다
// - Hive는 로컬에 데이터를 저장하는 데이터베이스입니다
import 'package:hive/hive.dart';

// part 지시문: 이 파일과 budget.g.dart 파일을 하나로 연결합니다
// - budget.g.dart는 Hive 어댑터 코드가 자동 생성되는 파일입니다
// - 'g'는 'generated'(생성됨)의 약자입니다
part 'budget.g.dart';

// =============================================================================
// Budget 클래스 - 예산 데이터를 담는 그릇
// =============================================================================
// @HiveType: 이 클래스가 Hive에 저장될 수 있는 타입임을 표시
// - typeId: 이 클래스의 고유 번호 (다른 모델과 중복되면 안 됨)
// - Budget = 0, SubBudget = 1, Expense = 2 로 구분
@HiveType(typeId: 0)
class Budget extends HiveObject {
  // HiveObject를 상속(extends)하면:
  // - save(), delete() 같은 편리한 메서드를 사용할 수 있습니다
  // - 데이터가 어느 Box에 저장되어 있는지 자동으로 추적합니다

  // ---------------------------------------------------------------------------
  // 필드(Field) 정의 - 예산이 가지는 속성들
  // ---------------------------------------------------------------------------
  // @HiveField: 이 필드가 Hive에 저장된다는 표시
  // - 괄호 안의 숫자는 필드 번호 (한 번 정하면 바꾸면 안 됨!)
  // - 필드를 추가할 때는 새로운 번호를 사용해야 합니다

  // 고유 식별자 (ID)
  // - 각 예산을 구분하기 위한 고유한 문자열
  // - UUID 형식으로 생성됩니다 (예: "a1b2c3d4-e5f6-...")
  @HiveField(0)
  String id;

  // 예산 이름
  // - 사용자가 입력하는 예산의 이름
  // - 예: "식비", "교통비", "문화생활" 등
  @HiveField(1)
  String name;

  // 예산 금액 (원 단위)
  // - int 타입으로 정수만 저장 (소수점 없음)
  // - 예: 300000 (30만원)
  @HiveField(2)
  int amount;

  // 연도
  // - 이 예산이 속한 연도
  // - 예: 2025
  @HiveField(3)
  int year;

  // 월
  // - 이 예산이 속한 월 (1~12)
  // - 예: 1 (1월)
  @HiveField(4)
  int month;

  // 매달 적용 여부
  // - true: 다음 달에도 이 예산이 자동으로 복사됨
  // - false: 이번 달에만 적용
  @HiveField(5)
  bool isRecurring;

  // ---------------------------------------------------------------------------
  // 생성자 (Constructor) - 객체를 만들 때 호출되는 함수
  // ---------------------------------------------------------------------------
  // required: 이 매개변수는 반드시 전달해야 함
  // this.필드명: 전달받은 값을 해당 필드에 바로 할당
  Budget({
    required this.id,          // ID는 필수
    required this.name,        // 이름은 필수
    required this.amount,      // 금액은 필수
    required this.year,        // 연도는 필수
    required this.month,       // 월은 필수
    this.isRecurring = false,  // 매달 적용은 선택 (기본값: false)
  });

  // ---------------------------------------------------------------------------
  // copyWith() 메서드 - 기존 객체를 복사하면서 일부 값만 변경
  // ---------------------------------------------------------------------------
  // 왜 필요한가?
  // - Dart에서 객체의 필드를 직접 수정하면 추적이 어렵습니다
  // - 새 객체를 만들어서 변경하면 상태 관리가 더 쉬워집니다
  //
  // 사용 예시:
  // final newBudget = oldBudget.copyWith(amount: 500000);
  // → 금액만 50만원으로 바뀌고 나머지는 그대로인 새 객체 생성
  Budget copyWith({
    String? id,           // ? = nullable (값이 없을 수 있음)
    String? name,
    int? amount,
    int? year,
    int? month,
    bool? isRecurring,
  }) {
    // 새로운 Budget 객체를 생성해서 반환
    return Budget(
      // ?? 연산자: 왼쪽이 null이면 오른쪽 값 사용
      // 예: id ?? this.id → id가 null이면 기존 this.id 사용
      id: id ?? this.id,
      name: name ?? this.name,
      amount: amount ?? this.amount,
      year: year ?? this.year,
      month: month ?? this.month,
      isRecurring: isRecurring ?? this.isRecurring,
    );
  }
}
