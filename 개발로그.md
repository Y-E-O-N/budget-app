 수정 사항 분석 및 계획                                                             
                                                                                     
  총 14개의 수정 사항을 분석했습니다. 각 항목별 상세 계획과 연관성을 정리합니다.                                                                                          
  ---                                                                                  📁 수정 파일별 분류
  ┌───────────────────────────────────┬─────────────────────────────────┐
  │               파일                │            수정 항목            │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ budget_tab.dart                   │ #1, #2, #3, #6, #7, #8, #9, #10 │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ stats_tab.dart                    │ #4, #5, #12                     │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ history_tab.dart                  │ #11-1                           │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ budget_detail_screen.dart         │ #1, #14                         │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ format_utils.dart                 │ #4                              │
  ├───────────────────────────────────┼─────────────────────────────────┤
  │ ai_analysis_service.dart + 백엔드 │ #13                             │
  └───────────────────────────────────┴─────────────────────────────────┘
  ---
  🔧 각 수정 사항별 상세 계획

  #1. 키보드로 인한 버튼 겹침 현상

  - 파일: budget_tab.dart, budget_detail_screen.dart (다이얼로그 전체)
  - 원인: AlertDialog 내 키보드가 올라올 때 버튼이 고정되지 않음
  - 수정 방안:
    - SingleChildScrollView로 content 감싸기
    - resizeToAvoidBottomInset: true 확인
    - 다이얼로그에 insetPadding 조정
  - 난이도: ⭐⭐ (쉬움)
  - 영향: 모든 입력 다이얼로그

  ---
  #2. 예산 정렬 기능 추가

  - 파일: budget_tab.dart
  - 수정 방안:
    - _sortOption 상태 추가 (예산명/예산금액/사용금액/잔여금액)
    - 헤더 셀에 정렬 아이콘/터치 기능 추가
    - budgets.sort() 로직 구현
  - 난이도: ⭐⭐⭐ (중간)
  - 영향: BudgetProvider.currentBudgets 순서에는 영향 없음 (UI 정렬만)

  ---
  #3. 예산 순서 조정 기능

  - 파일: budget_tab.dart, budget_provider.dart, budget.dart
  - 수정 방안:
    - Budget 모델에 order 필드 추가 (Hive 마이그레이션 필요)
    - 드래그앤드롭 또는 순서변경 UI 추가
    - ReorderableListView 사용 고려
  - 난이도: ⭐⭐⭐⭐ (복잡)
  - 영향: 데이터 모델 변경 → Hive 마이그레이션 필요
  - ⚠️ 주의: 기존 데이터 호환성 확인 필요

  ---
  #4. 월별 지출추이 그래프 '월' 중복 표기

  - 파일: stats_tab.dart:467-528 (테이블 헤더 + 차트 bottomTitles)
  - 원인: FormatUtils.formatMonth(d.month) → 1월월 형태로 중복
  - 수정 방안:
  // format_utils.dart 수정
  static String formatMonth(int month) => '$month';  // '월' 제거
  - 또는 테이블/차트에서 직접 '$month' 사용
  - 난이도: ⭐ (매우 쉬움)
  - 영향: 트렌드 탭 UI만

  ---
  #5. 데이터 없을 때 '-' 표시

  - 파일: stats_tab.dart:478-479
  - 현재: 금액이 0이면 0만 또는 0 표시
  - 수정 방안:
  _buildCell(d.expense > 0 ? FormatUtils.formatAmountShort(d.expense) : '-', ...)    
  - 난이도: ⭐ (매우 쉬움)
  - 영향: 트렌드 테이블 UI만

  ---
  #6. 예산 탭 '>' 화살표 제거 및 예산명 너비 확장

  - 파일: budget_tab.dart:159-174, budget_tab.dart:305-356
  - 수정 방안:
    - 헤더의 5번째 열(화살표) 제거
    - _BudgetRow의 화살표 셀 제거
    - columnWidths 조정: 기존 4열 → 4열 유지하되 예산명 FlexColumnWidth(3) 확대      
  - 난이도: ⭐⭐ (쉬움)
  - 영향: 예산 탭 레이아웃만

  ---
  #7. 반복 예산 화살표 마크(repeat 아이콘) 삭제

  - 파일: budget_tab.dart:333-334
  - 현재 코드:
  if (budget.isRecurring)
    Icon(Icons.repeat, size: 14, color: Theme.of(context).colorScheme.primary),      
  - 수정 방안: 해당 코드 삭제
  - 난이도: ⭐ (매우 쉬움)
  - 영향: 없음 (단순 UI 삭제)

  ---
  #8. 헤더 텍스트 중앙 정렬

  - 파일: budget_tab.dart:171-174
  - 현재: align: TextAlign.right (우측 정렬)
  - 수정 방안: align: TextAlign.center 변경
  - 난이도: ⭐ (매우 쉬움)
  - 영향: 예산 탭 헤더 UI만

  ---
  #9. 날짜 형식 '2026년 2월'로 변경

  - 파일: budget_tab.dart:69
  - 현재: '${provider.currentYear}. ${provider.currentMonth}' → 2026. 2
  - 수정 방안:
  '${provider.currentYear}년 ${provider.currentMonth}월'
  - 난이도: ⭐ (매우 쉬움)
  - 영향: 예산 탭 상단 타이틀만

  ---
  #10. 날짜 터치시 달력/월 선택 UI

  - 파일: budget_tab.dart:69
  - 수정 방안:
    - 날짜 텍스트를 InkWell로 감싸기
    - showDatePicker 또는 커스텀 월 선택 다이얼로그 구현
    - 선택 후 provider.setYearMonth(year, month) 호출
  - 참고: BudgetProvider에 setYearMonth 메서드 추가 필요
  - 난이도: ⭐⭐⭐ (중간)
  - 영향: budget_provider.dart 수정 필요

  ---
  #11-1. 내역 검색에서 예산 선택 기능 제거

  - 파일: history_tab.dart:365-409
  - 수정 방안: 필터 패널에서 예산/세부예산 드롭다운 제거
    - _selectedBudgetId, _selectedSubBudgetId 상태 제거
    - _buildFilterPanel 내 관련 UI 제거
  - 난이도: ⭐⭐ (쉬움)
  - 영향: 검색 필터 기능 축소

  ---
  #12. 통계탭 상단 형식 변경 + 월 네비게이션

  - 파일: stats_tab.dart:67, 78
  - 수정 방안:
    - 날짜 형식: '${provider.currentYear}년 ${provider.currentMonth}월
  ${loc.tr('statsTab')}'
    - AppBar에 월 이동 버튼 추가 (예산탭과 동일하게)
  Row(mainAxisSize: MainAxisSize.min, children: [
    IconButton(icon: const Icon(Icons.chevron_left), onPressed: () =>
  provider.previousMonth()),
    Text('${provider.currentYear}년 ${provider.currentMonth}월'),
    IconButton(icon: const Icon(Icons.chevron_right), onPressed: () =>
  provider.nextMonth()),
  ])
  - 난이도: ⭐⭐ (쉬움)
  - 영향: 통계 탭 UI 및 데이터 연동

  ---
  #13. LLM 분석시 잔여 기간 지출 계획 조언 추가

  - 파일: 백엔드 API (프롬프트 수정) + ai_analysis_service.dart (응답 스키마)        
  - 수정 방안:
    - 백엔드 프롬프트에 "잔여 기간(월말까지 남은 일수)과 잔여 예산을 고려한 일일 지출
   권장액" 항목 추가
    - AiAnalysisResponse에 새 필드 추가 가능
    - stats_tab.dart 결과 다이얼로그에 표시
  - 난이도: ⭐⭐⭐ (중간, 백엔드 연동)
  - 영향: API 스키마 변경 가능

  ---
  #14. 복제 버튼 수정 (날짜 선택 후 등록)

  - 파일: budget_detail_screen.dart:477-494
  - 현재 문제: 즉시 복제 후 스낵바만 표시
  - 수정 방안:
    - _duplicateExpense → _showDuplicateExpenseDialog 변경
    - 기존 지출 정보를 pre-fill한 다이얼로그 표시
    - 날짜만 기본값을 오늘로 설정
    - 사용자가 날짜 수정 후 저장 버튼 클릭시 등록
  - 난이도: ⭐⭐⭐ (중간)
  - 영향: 복제 UX 개선

  ---
  🔗 연관성 및 의존성 분석

  #9, #10, #12 → 날짜 형식 통일 (함께 작업 권장)
  #6, #7, #8 → 예산 탭 테이블 레이아웃 (함께 작업 권장)
  #4, #5 → 트렌드 탭 테이블 (함께 작업 권장)
  #3 → 단독 작업 (모델 변경 포함)
  #14 → 단독 작업
  #13 → 백엔드 의존성

  ---
  ⚠️ 호환성 검토
  항목: #3 예산 순서
  위험도: 🔴 높음
  설명: Budget 모델에 order 필드 추가 → Hive TypeAdapter 재생성 필요. 기존 데이터    
    마이그레이션 로직 필요
  ────────────────────────────────────────
  항목: #13 LLM 조언
  위험도: 🟡 중간
  설명: 백엔드 API 변경 필요. 응답 스키마 확장시 하위 호환성 유지 가능
  ────────────────────────────────────────
  항목: 나머지
  위험도: 🟢 낮음
  설명: UI 수정만으로 기존 데이터/동작에 영향 없음
  ---
  📋 권장 수정 순서

  1. 1단계 (간단한 UI 수정): #4, #5, #6, #7, #8, #9 → 동시 작업 가능
  2. 2단계 (중간 복잡도): #1, #10, #11-1, #12, #14
  3. 3단계 (복잡/의존성): #2, #3, #13

  이 순서대로 진행하면 좋을까요? 또는 특정 항목부터 시작하고 싶으시면 말씀해주세요. 



  ======================================================================

   ✅ 2단계 완료

  모든 중간 복잡도 수정이 완료되었습니다.

  수정 내역 요약
  항목: #1
  파일: budget_tab.dart, budget_detail_screen.dart
  변경 내용: 모든 입력 다이얼로그에 SingleChildScrollView 적용
  ────────────────────────────────────────
  항목: #10
  파일: budget_provider.dart, budget_tab.dart
  변경 내용: setYearMonth() 메서드 추가, 날짜 터치시 월 선택 다이얼로그 (연도 이동 + 
  월
    그리드)
  ────────────────────────────────────────
  항목: #11-1
  파일: history_tab.dart
  변경 내용: 예산/세부예산 필터 드롭다운 제거, 기간 필터만 유지
  ────────────────────────────────────────
  항목: #12
  파일: stats_tab.dart
  변경 내용: 날짜 형식 '2026년 2월' + 월 이동 버튼(< >) 추가
  ────────────────────────────────────────
  항목: #14
  파일: budget_detail_screen.dart
  변경 내용: 복제시 다이얼로그로 날짜/메모/금액 수정 가능하도록 변경
  ---
  수정된 파일 목록

  1. lib/screens/budget_tab.dart - 다이얼로그 스크롤, 월 선택 UI
  2. lib/screens/budget_detail_screen.dart - 다이얼로그 스크롤, 복제 다이얼로그      
  3. lib/screens/stats_tab.dart - 월 네비게이션, 날짜 형식
  4. lib/screens/history_tab.dart - 예산 필터 제거
  5. lib/providers/budget_provider.dart - setYearMonth() 추가

  ==================================================================================

  ● ✅ 3단계 진행 완료

  완료된 수정 내역
  항목: #15
  파일: budget_detail_screen.dart
  변경 내용: 예산 상세 AppBar에 월 이동 버튼 추가 (월 변경시 목록으로 복귀)
  ────────────────────────────────────────
  항목: #16
  파일: settings_tab.dart:54
  변경 내용: 시작요일 설정 행 주석처리 (UI에서 숨김)
  ────────────────────────────────────────
  항목: #2
  파일: budget_tab.dart
  변경 내용: StatefulWidget 변환, 헤더 터치로 정렬 (이름/금액/사용/잔여
    오름차순↔내림차순)
  ---
  정렬 기능 사용법 (#2)

  - 헤더 셀(예산명, 예산, 사용, 남음)을 터치하면 정렬
  - 1번 터치: 오름차순 ↑
  - 2번 터치: 내림차순 ↓
  - 3번 터치: 기본(이름순)으로 복귀
  - 활성 정렬 열은 파란색 + 화살표 표시

  ---
  남은 작업 (복잡/백엔드 연동)
  항목: #3
  복잡도: 🔴 높음
  설명: 예산 순서 조정 - Budget 모델에 order 필드 추가, Hive 마이그레이션 필요       
  ────────────────────────────────────────
  항목: #13
  복잡도: 🟡 중간
  설명: LLM 잔여 기간 조언 - 백엔드 프롬프트 수정 필요
  ────────────────────────────────────────
  항목: #17
  복잡도: 🔴 높음
  설명: FastAPI 분리 + 일 3회 제한 - 새 백엔드 서비스 개발, 기기 고유값 처리 필요    
  이 작업들도 계속 진행할까요? (#3은 모델 변경, #13/#17은 백엔드 작업)


  ==========================================================================================


  ● 백엔드 작업 완료!

  ---
  #17. AI 분석 FastAPI 분리 + 일 3회 제한

  FastAPI 서버 (budget_api/main.py) 수정:
  - SQLite DB로 device_id별 일일 사용량 추적 (usage.db)
  - KST 기준 일일 3회 제한 (429 Too Many Requests 반환)
  - /api/usage/{device_id} - 현재 사용량 조회 API 추가
  - 다국어 에러 메시지 (ko/en/ja)
  - 7일 지난 데이터 자동 정리

  Flutter 앱 수정:
  - ai_analysis_service.dart - device_id 생성/저장 (UUID, Hive)
  - result.dart - rateLimit 에러 타입 추가
  - error_messages.dart - 사용량 초과 메시지 추가 (ko/en/ja)

  ---
  #13. LLM 잔여 기간 지출 계획 조언

  FastAPI 프롬프트 수정:
  - spendingPlan 필드 추가 (예: "남은 15일간 하루 평균 3만원 이내로 지출하면 예산 내 
  유지 가능")

  Flutter 앱 수정:
  - AiAnalysisResponse에 spendingPlan, remainingAnalyses 필드 추가
  - analysis_provider.dart - JSON 직렬화에 새 필드 포함
  - stats_tab.dart - 분석 결과 다이얼로그에 지출 계획 섹션 추가
  - app_localizations.dart - 'spendingPlan' 다국어 문자열 추가

  ---
  서버 실행 방법:
  cd c:\SY\app\budget_api
  pip install fastapi uvicorn httpx python-dotenv
  uvicorn main:app --host 0.0.0.0 --port 3000

========================================================================

  ❯ 그러면 이건 서버를 실행한 곳의 로컬 저장소에 저장되는거야?                                                                        
● 네, 맞습니다.                                                                      
  
  DB_PATH = os.path.join(os.path.dirname(__file__), "usage.db")                         
  이 코드에 따라 main.py와 같은 폴더에 usage.db 파일이 생성됩니다.                   
  
  c:\SY\app\budget_api\
  ├── main.py
  ├── usage.db       ← 여기에 SQLite DB 저장
  ├── .env
  └── ...

  확인 방법

  # DB 파일 존재 확인
  dir c:\SY\app\budget_api\usage.db

  # SQLite로 직접 조회
  sqlite3 c:\SY\app\budget_api\usage.db "SELECT * FROM analysis_logs LIMIT 5;"       

  또는 브라우저에서:
  - http://192.168.0.136:3000/api/logs - 로그 목록
  - http://192.168.0.136:3000/api/logs/stats - 통계

  참고

  - 서버가 실행되는 컴퓨터에만 저장됨
  - 서버 종료 후에도 데이터 유지됨
  - 다른 컴퓨터로 서버를 옮기면 usage.db 파일도 함께 복사해야 함

  ================================================
  ● 변경 사항 요약

  #26: AI 분석 결과를 새 페이지로 표시 ✅                                              
  - analysis_result_screen.dart 신규 생성 - AI 분석 결과 전용 전체 화면              
  - stats_tab.dart에서 다이얼로그 대신 새 페이지로 네비게이션하도록 수정

  #27: AI 분석 결과 이미지(PNG) 내보내기 ✅

  - analysis_result_screen.dart에 RepaintBoundary와 이미지 캡처 기능 추가
  - AppBar에 공유 버튼 추가하여 PNG로 내보내기 가능
  - pubspec.yaml에 share_plus, path_provider 패키지 추가

  #28: 정기지출 예산을 AI가 고정지출로 인식하도록 수정 ✅

  - markdown_export_service.dart 수정하여 지출 유형(고정지출/변동지출) 정보 포함     
  - _isFixedExpenseBudget() 헬퍼 추가 - 예산명에 '정기', '고정', '월세', '보험',     
  '통신', '구독' 등 키워드 포함 시 고정지출로 인식
  - 예산 요약 테이블에 유형 열 추가
  - 지출 내역에도 각 지출이 고정/변동인지 표시

  #29: AI 분석 전 잔여횟수 확인 다이얼로그 ✅

  - stats_tab.dart에 _showAnalysisConfirmDialog() 메서드 추가
  - 분석 요청 전 오늘의 잔여 횟수 표시
  - 잔여 횟수가 0이면 분석 버튼 비활성화

  #30: AI 분석 상태 알림을 통계탭 하단에 표시 ✅

  - _buildAnalysisStatusBanner()를 현황 탭 상단에서 하단으로 이동

  다국어 추가

  - 한국어, 영어, 일본어 모두 새 문자열 추가:
    - exportImage: 이미지로 내보내기
    - analysisConfirmMessage: AI 분석을 요청하시겠습니까?
    - remainingAnalyses: 오늘 남은 분석 횟수
    - noRemainingAnalyses: 오늘 분석 횟수를 모두 사용했습니다
    - usageCheckFailed: 잔여 횟수 조회 실패

  ---


   완료되었습니다. 푸시해주세요:

  cd c:/SY/app/budget-app
  git push origin main

  ---
  구현 내용

  1. database.py - 추상화 레이어

  # 환경변수에 따라 자동 전환
  db = create_database()

  # DATABASE_URL이 없으면 → SQLite (현재)
  # DATABASE_URL이 있으면 → PostgreSQL

  2. 지원 기능
  ┌───────────────────────────────┬────────────────────┐
  │            메서드             │        설명        │
  ├───────────────────────────────┼────────────────────┤
  │ db.init_db()                  │ 테이블 생성        │
  ├───────────────────────────────┼────────────────────┤
  │ db.get_usage_count(device_id) │ 사용량 조회        │
  ├───────────────────────────────┼────────────────────┤
  │ db.increment_usage(device_id) │ 사용량 증가        │
  ├───────────────────────────────┼────────────────────┤
  │ db.save_analysis_log(...)     │ 로그 저장          │
  ├───────────────────────────────┼────────────────────┤
  │ db.get_logs(...)              │ 로그 조회          │
  ├───────────────────────────────┼────────────────────┤
  │ db.get_logs_stats()           │ 통계 조회          │
  ├───────────────────────────────┼────────────────────┤
  │ db.cleanup_old_data()         │ 오래된 데이터 삭제 │
  └───────────────────────────────┴────────────────────┘
  3. PostgreSQL 전환 방법 (나중에 필요 시)

  1. Neon, Supabase 등에서 PostgreSQL DB 생성
  2. Koyeb 환경변수에 DATABASE_URL 추가:
  DATABASE_URL=postgresql://user:password@host:5432/dbname
  3. 재배포 → 자동으로 PostgreSQL 사용

  현재는 SQLite로 동작하며, 나중에 환경변수만 추가하면 PostgreSQL로 전환됩니다.

  ===================================================================================

  Neon에서 AWS vs Azure 선택                                                         
                                                                                     
  한국 사용자 기준 추천: AWS ⭐                                                        ┌───────────────┬────────────────────────────┬─────────────────────────────────┐   
  │     항목      │            AWS             │              Azure              │   
  ├───────────────┼────────────────────────────┼─────────────────────────────────┤   
  │ 가까운 리전   │ Singapore (ap-southeast-1) │ 없음 (가장 가까운게 Japan East) │   
  ├───────────────┼────────────────────────────┼─────────────────────────────────┤   
  │ 한국 레이턴시 │ ~50-80ms                   │ ~80-120ms                       │   
  ├───────────────┼────────────────────────────┼─────────────────────────────────┤   
  │ 안정성        │ Neon 메인 인프라           │ 상대적으로 새로움               │   
  ├───────────────┼────────────────────────────┼─────────────────────────────────┤   
  │ 리전 수       │ 더 많음                    │ 적음                            │   
  └───────────────┴────────────────────────────┴─────────────────────────────────┘   
  ---
  상세 비교

  AWS (Amazon Web Services)
  - Neon의 기본/메인 인프라
  - Singapore 리전 제공 → 한국에서 가장 가까움
  - 더 오래되고 안정적
  - 대부분의 Neon 문서/예제가 AWS 기준

  Azure (Microsoft Azure)
  - 상대적으로 최근 추가됨
  - 아시아 리전이 제한적
  - Microsoft 생태계(Azure Functions 등)와 연동 시 유리
  - 회사에서 Azure만 허용하는 경우 선택

  ---
  결론

  AWS + Singapore 리전 선택하세요.

  한국에서 가장 낮은 레이턴시를 제공하고, Neon에서 가장 안정적인 옵션입니다.

  -------------
  ● Neon PostgreSQL 연결 성공! 🎉

  ---                                                                                  이제 달라진 점
  ┌──────────────────┬─────────────────────┬────────────────────────┐                
  │       항목       │    이전 (SQLite)    │ 현재 (Neon PostgreSQL) │                
  ├──────────────────┼─────────────────────┼────────────────────────┤
  │ 데이터 저장 위치 │ Koyeb 컨테이너 내부 │ Neon 클라우드 DB       │
  ├──────────────────┼─────────────────────┼────────────────────────┤
  │ 재배포 시        │ ❌ 초기화됨         │ ✅ 유지됨              │
  ├──────────────────┼─────────────────────┼────────────────────────┤
  │ 일일 3회 제한    │ 배포마다 리셋       │ 정상 작동              │
  ├──────────────────┼─────────────────────┼────────────────────────┤
  │ 분석 로그        │ 사라짐              │ 영구 보존              │
  └──────────────────┴─────────────────────┴────────────────────────┘
  ---
  확인 방법

  Neon 대시보드에서 테이블 확인:
  1. https://console.neon.tech 접속
  2. 프로젝트 선택 → Tables 탭
  3. usage, analysis_logs 테이블 생성 확인

  ---